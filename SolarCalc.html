<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>True Solar Time Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #1a1a1a;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Simple icon components
        const Sun = () => (
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        );

        const Clock = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const MapPin = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        function SolarTimeCalculator() {
            const [clockTime, setClockTime] = useState('12:00');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const [longitude, setLongitude] = useState('');
            const [timezone, setTimezone] = useState('');
            const [result, setResult] = useState(null);
            const [cityName, setCityName] = useState('');
            const [searching, setSearching] = useState(false);
            const [cityInfo, setCityInfo] = useState(null);

            const calculateEquationOfTime = (date) => {
                const d = new Date(date);
                const startOfYear = new Date(d.getFullYear(), 0, 1);
                const dayOfYear = Math.floor((d - startOfYear) / (1000 * 60 * 60 * 24)) + 1;

                const B = (2 * Math.PI / 365) * (dayOfYear - 81);
                const EoT = 9.87 * Math.sin(2 * B) - 7.53 * Math.cos(B) - 1.5 * Math.sin(B);

                return EoT;
            };

            const searchCity = async () => {
                if (!cityName.trim()) {
                    alert('Please enter a city name');
                    return;
                }

                setSearching(true);
                setCityInfo(null);

                try {
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(cityName)}&format=json&limit=1`,
                        {
                            headers: {
                                'User-Agent': 'SolarTimeCalculator/1.0'
                            }
                        }
                    );

                    const data = await response.json();

                    if (data.length === 0) {
                        alert('City not found. Please try another name or be more specific.');
                        setSearching(false);
                        return;
                    }

                    const location = data[0];
                    const lng = parseFloat(location.lon);
                    const lat = parseFloat(location.lat);

                    const estimatedTzOffset = Math.round(lng / 15);

                    setLongitude(lng.toFixed(4));
                    setTimezone(estimatedTzOffset.toString());
                    setCityInfo({
                        name: location.display_name,
                        lat: lat.toFixed(4),
                        lng: lng.toFixed(4)
                    });

                } catch (error) {
                    alert('Error searching for city: ' + error.message);
                } finally {
                    setSearching(false);
                }
            };

            const calculateSolarTime = () => {
                if (!clockTime || !longitude || !timezone) {
                    alert('Please fill in all fields');
                    return;
                }

                const [hours, minutes] = clockTime.split(':').map(Number);
                const totalMinutes = hours * 60 + minutes;

                const tzOffset = parseFloat(timezone);
                const standardMeridian = tzOffset * 15;

                const lng = parseFloat(longitude);
                const longitudeCorrection = (lng - standardMeridian) * 4;

                const eot = calculateEquationOfTime(date);

                const solarMinutes = totalMinutes + longitudeCorrection + eot;

                let adjustedMinutes = solarMinutes;
                let dayOffset = 0;

                if (adjustedMinutes < 0) {
                    adjustedMinutes += 1440;
                    dayOffset = -1;
                } else if (adjustedMinutes >= 1440) {
                    adjustedMinutes -= 1440;
                    dayOffset = 1;
                }

                const solarHours = Math.floor(adjustedMinutes / 60);
                const solarMins = Math.floor(adjustedMinutes % 60);
                const solarSecs = Math.floor((adjustedMinutes % 1) * 60);

                const solarTime = `${solarHours.toString().padStart(2, '0')}:${solarMins.toString().padStart(2, '0')}:${solarSecs.toString().padStart(2, '0')}`;

                setResult({
                    solarTime,
                    longitudeCorrection: longitudeCorrection.toFixed(2),
                    equationOfTime: eot.toFixed(2),
                    totalCorrection: (longitudeCorrection + eot).toFixed(2),
                    dayOffset
                });
            };

            const getCurrentLocation = () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            setLongitude(position.coords.longitude.toFixed(4));
                            const tzOffset = -new Date().getTimezoneOffset() / 60;
                            setTimezone(tzOffset.toString());
                            setCityInfo({
                                name: 'Your Current Location',
                                lat: position.coords.latitude.toFixed(4),
                                lng: position.coords.longitude.toFixed(4)
                            });
                        },
                        (error) => {
                            alert('Unable to get location: ' + error.message);
                        }
                    );
                } else {
                    alert('Geolocation is not supported by your browser');
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-8">
                    <div className="max-w-2xl mx-auto">
                        <div className="bg-gray-800 rounded-2xl shadow-2xl p-8 border border-gray-700">
                            <div className="flex items-center gap-3 mb-6">
                                <div className="text-amber-400">
                                    <Sun />
                                </div>
                                <h1 className="text-3xl font-bold text-gray-100">True Solar Time Calculator</h1>
                            </div>

                            <p className="text-gray-400 mb-8">
                                Convert clock time to true solar time based on your location and the equation of time.
                            </p>

                            <div className="space-y-6">
                                <div className="p-4 bg-gray-700/50 rounded-lg border border-gray-600">
                                    <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-3">
                                        <MapPin />
                                        Search by City Name
                                    </label>
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={cityName}
                                            onChange={(e) => setCityName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && searchCity()}
                                            placeholder="Enter city name (e.g., London, New York)"
                                            className="flex-1 px-4 py-3 bg-gray-700 border border-gray-600 text-gray-100 placeholder-gray-500 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                                        />
                                        <button
                                            onClick={searchCity}
                                            disabled={searching}
                                            className="px-6 py-3 bg-amber-600 hover:bg-amber-700 disabled:bg-gray-600 text-white font-medium rounded-lg transition-colors"
                                        >
                                            {searching ? 'Searching...' : 'Search'}
                                        </button>
                                    </div>
                                    {cityInfo && (
                                        <div className="mt-3 p-3 bg-gray-600/50 rounded border border-gray-500">
                                            <p className="text-sm font-medium text-gray-200">{cityInfo.name}</p>
                                            <p className="text-xs text-gray-400 mt-1">
                                                Coordinates: {cityInfo.lat}, {cityInfo.lng}
                                            </p>
                                        </div>
                                    )}
                                </div>

                                <div className="text-center text-gray-600 text-sm">OR</div>

                                <div>
                                    <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                                        <Clock />
                                        Clock Time (Local Time)
                                    </label>
                                    <input
                                        type="time"
                                        value={clockTime}
                                        onChange={(e) => setClockTime(e.target.value)}
                                        className="w-full px-4 py-3 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                                    />
                                </div>

                                <div>
                                    <label className="text-sm font-medium text-gray-300 mb-2 block">
                                        Date
                                    </label>
                                    <input
                                        type="date"
                                        value={date}
                                        onChange={(e) => setDate(e.target.value)}
                                        className="w-full px-4 py-3 bg-gray-700 border border-gray-600 text-gray-100 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                                    />
                                </div>

                                <div className="flex gap-4">
                                    <div className="flex-1">
                                        <label className="flex items-center gap-2 text-sm font-medium text-gray-300 mb-2">
                                            <MapPin />
                                            Longitude (degrees)
                                        </label>
                                        <input
                                            type="number"
                                            step="0.0001"
                                            value={longitude}
                                            onChange={(e) => setLongitude(e.target.value)}
                                            placeholder="-74.0060"
                                            className="w-full px-4 py-3 bg-gray-700 border border-gray-600 text-gray-100 placeholder-gray-500 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">West: negative, East: positive</p>
                                    </div>

                                    <div className="flex-1">
                                        <label className="text-sm font-medium text-gray-300 mb-2 block">
                                            Timezone Offset (hours)
                                        </label>
                                        <input
                                            type="number"
                                            step="0.5"
                                            value={timezone}
                                            onChange={(e) => setTimezone(e.target.value)}
                                            placeholder="-5"
                                            className="w-full px-4 py-3 bg-gray-700 border border-gray-600 text-gray-100 placeholder-gray-500 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">UTC offset (e.g., -5 for EST)</p>
                                    </div>
                                </div>

                                <button
                                    onClick={getCurrentLocation}
                                    className="w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg transition-colors text-sm border border-gray-600"
                                >
                                    Or Use My Current GPS Location
                                </button>

                                <button
                                    onClick={calculateSolarTime}
                                    className="w-full py-4 px-6 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white font-semibold rounded-lg shadow-lg transition-all transform hover:scale-105"
                                >
                                    Calculate True Solar Time
                                </button>

                                {result && (
                                    <div className="mt-8 p-6 bg-gradient-to-r from-gray-700/80 to-gray-700/60 rounded-xl border-2 border-amber-600/50">
                                        <h2 className="text-xl font-bold text-gray-100 mb-4">Result</h2>

                                        <div className="space-y-3">
                                            <div className="flex justify-between items-center py-3 border-b border-gray-600">
                                                <span className="text-gray-300">True Solar Time:</span>
                                                <span className="text-2xl font-bold text-amber-400">
                                                    {result.solarTime}
                                                    {result.dayOffset !== 0 && (
                                                        <span className="text-sm text-gray-400 ml-2">
                                                            ({result.dayOffset > 0 ? 'next day' : 'previous day'})
                                                        </span>
                                                    )}
                                                </span>
                                            </div>

                                            <div className="text-sm space-y-2 pt-2">
                                                <div className="flex justify-between">
                                                    <span className="text-gray-400">Longitude Correction:</span>
                                                    <span className="font-medium text-gray-200">{result.longitudeCorrection} min</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-400">Equation of Time:</span>
                                                    <span className="font-medium text-gray-200">{result.equationOfTime} min</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-400">Total Correction:</span>
                                                    <span className="font-medium text-gray-200">{result.totalCorrection} min</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="mt-8 p-4 bg-gray-700/50 rounded-lg border border-gray-600">
                                <h3 className="font-semibold text-gray-200 mb-2">How it works:</h3>
                                <ul className="text-sm text-gray-400 space-y-1">
                                    <li>• True solar time is when the sun is exactly at its highest point at noon</li>
                                    <li>• Clock time differs due to time zones and Earth's elliptical orbit</li>
                                    <li>• The equation of time varies from -14 to +16 minutes throughout the year</li>
                                    <li>• Longitude correction: 4 minutes per degree from timezone meridian</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SolarTimeCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
